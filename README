GRUB2 Live ISO Multiboot
========================

http://glee.thias.es/GLIM

The following instructions assume your USB drive is mounted on /mnt, so adjust
accordingly. My experience has been that the safest filesystem to use is FAT32
(surprisingly!), though it will mean that ISO images greater than 4GB won't be
supported. NTFS works, but the installer of distributions such as Fedora can't
read it, so they won't work.

All instructions require you to be root.

Set the variable we'll use in examples :

export USBDRIVE=/mnt

Install GRUB2 to the USB device's MBR :

grub2-install --boot-directory=${USBDRIVE:-/mnt}/boot /dev/sdx
 -or- (Ubuntu, for instance)
grub-install --boot-directory=${USBDRIVE:-/mnt}/boot /dev/sdx

Errors and solutions :
 * "source_dir doesn't exist. Please specify --target or --directory"
   Find your grub2 directory and specify it. Example :
   --directory=/usr/lib/grub/i386-pc
 * --force : If your partitions start at 63 instead of more, such as 2048


Copy over the grub.cfg file as well as the theme it uses :

rsync -avP grub2/ ${USBDRIVE:-/mnt}/boot/grub2

If you want to avoid keeping unused translations, themes, etc, instead :

rsync -avP --delete --exclude=i386-pc grub2/ ${USBDRIVE:-/mnt}/boot/grub2


Now create and populate the ${USBDRIVE}/boot/iso/ sub-directories. Example :

iso/gparted:
 gparted-live-0.14.0-1.iso
iso/ipxe:
 ipxe.iso
iso/sysrescd:
 systemrescuecd-x86-3.0.0.iso
iso/ubuntu:
 ubuntu-12.04.1-desktop-amd64.iso
 ubuntu-12.04.1-desktop-i386.iso
 ubuntu-12.10-desktop-amd64.iso
 ubuntu-12.10-desktop-i386.iso

The supported sub-directories are :
arch debian fedora gparted grml ipxe knoppix linuxmint pmagic rhel sysrescd ubuntu

Any missing sub-directory will have the matching boot menu entry automatically
disabled, so to skip any distribution(s), just don't create its directory.

If you require different versions, or just part of a distributions, edit the
appropriate inc-*.cfg file.

Note that on 32bit computers, all 64bit entries will be automatically disabled.

Fedora Live ISOs require a patched initrd to work (still as of Fedora 17) :
https://bugzilla.redhat.com/show_bug.cgi?id=650672
https://gist.github.com/2132076

To create the required initrd files (about 15MB each), one per architecture
you will need (shared for all Desktop/KDE/LXDE/XFCE variants) :

./fedora18-fromiso ${USBDRIVE:-/mnt}/boot/iso/fedora/Fedora-18-i686-Live-Desktop.iso ${USBDRIVE:-/mnt}/boot/iso/fedora/Fedora-18-i686-initrd.img
./fedora18-fromiso ${USBDRIVE:-/mnt}/boot/iso/fedora/Fedora-18-x86_64-Live-Desktop.iso ${USBDRIVE:-/mnt}/boot/iso/fedora/Fedora-18-x86_64-initrd.img


Red Hat Enterprise Linux isn't "live" as such. And in order for the install to
work, you need to also copy the "images" directory from the DVD next to the DVD
ISO, and keep only "install.img" and "product.img".


Test your bootable GRUB2 USB memory :

With KVM it should "just work". The /dev/sdx device should be configured as
an IDE or SATA disk (for some reason, as USB disk didn't work for me on Fedora
17), that way you can easily and quickly test changes.
Make sure you unmount the disk from the host OS before you start the KVM
virtual machine that uses it.


If you have any problem to boot, for instance stuck at the GRUB prompt before
the menu, try running grub-install again.
If you have other exotic GRUB errors, try formatting your USB memory with a
different filesystem. I've had the most luck with FAT32...


--
Copyleft 2012 Matthias Saou <matthias@saou.eu>

All configuration files included are public domain. Do what you want with them.
The invader logo was made by me, so unless the exact shape is covered by
copyright somewhere, do what you want with it.
The terminal_box_*.png files are CC-BY-SA-3.0 and come from the GRUB2 starfield
theme by Daniel Tschudi.
The ascii.pf2 font comes from GRUB, which is GPLv3+ licensed. For more details 
as well as the source code, see http://www.gnu.org/software/grub/

